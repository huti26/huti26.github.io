<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>What I learned from building a Calorietracker/Budgeting WebApp with Flutter and Firebase | Hutan Baghery Moghaddam</title><meta name=keywords content="Flutter,Firebase,Personal Projects"><meta name=description content="Preface Flutter is first and foremost a Framework to create cross-platform applications, but it can also be used to create WebApps. Since I don&rsquo;t have any experience with the three big Web Frameworks: VueJS, React, and Angular, I thought Flutter would be a good fit for me. It also uses Dart instead Javascript. My initial impression was, that this is also an improvement. Since I have not made any proper experiences with other Web Frameworks or Javascript, I won&rsquo;t be able to compare those to Flutter/Dart in this article."><meta name=author content="Hutan Baghery Moghaddam"><link rel=canonical href=https://huti26.github.io/posts/flutter-calorietracker/flutter-calorietracker/><link crossorigin=anonymous href=../../../assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=../../../assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://huti26.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://huti26.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://huti26.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://huti26.github.io/apple-touch-icon.png><link rel=mask-icon href=https://huti26.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="What I learned from building a Calorietracker/Budgeting WebApp with Flutter and Firebase"><meta property="og:description" content="Preface Flutter is first and foremost a Framework to create cross-platform applications, but it can also be used to create WebApps. Since I don&rsquo;t have any experience with the three big Web Frameworks: VueJS, React, and Angular, I thought Flutter would be a good fit for me. It also uses Dart instead Javascript. My initial impression was, that this is also an improvement. Since I have not made any proper experiences with other Web Frameworks or Javascript, I won&rsquo;t be able to compare those to Flutter/Dart in this article."><meta property="og:type" content="article"><meta property="og:url" content="https://huti26.github.io/posts/flutter-calorietracker/flutter-calorietracker/"><meta property="og:image" content="https://huti26.github.io/flutter+firebase2.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-12T00:00:00+00:00"><meta property="article:modified_time" content="2022-05-12T00:00:00+00:00"><meta property="og:site_name" content="Hutan Baghery Moghaddam"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://huti26.github.io/flutter+firebase2.jpg"><meta name=twitter:title content="What I learned from building a Calorietracker/Budgeting WebApp with Flutter and Firebase"><meta name=twitter:description content="Preface Flutter is first and foremost a Framework to create cross-platform applications, but it can also be used to create WebApps. Since I don&rsquo;t have any experience with the three big Web Frameworks: VueJS, React, and Angular, I thought Flutter would be a good fit for me. It also uses Dart instead Javascript. My initial impression was, that this is also an improvement. Since I have not made any proper experiences with other Web Frameworks or Javascript, I won&rsquo;t be able to compare those to Flutter/Dart in this article."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://huti26.github.io/posts/"},{"@type":"ListItem","position":2,"name":"What I learned from building a Calorietracker/Budgeting WebApp with Flutter and Firebase","item":"https://huti26.github.io/posts/flutter-calorietracker/flutter-calorietracker/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"What I learned from building a Calorietracker/Budgeting WebApp with Flutter and Firebase","name":"What I learned from building a Calorietracker\/Budgeting WebApp with Flutter and Firebase","description":"Preface Flutter is first and foremost a Framework to create cross-platform applications, but it can also be used to create WebApps. Since I don\u0026rsquo;t have any experience with the three big Web Frameworks: VueJS, React, and Angular, I thought Flutter would be a good fit for me. It also uses Dart instead Javascript. My initial impression was, that this is also an improvement. Since I have not made any proper experiences with other Web Frameworks or Javascript, I won\u0026rsquo;t be able to compare those to Flutter/Dart in this article.","keywords":["Flutter","Firebase","Personal Projects"],"articleBody":"Preface Flutter is first and foremost a Framework to create cross-platform applications, but it can also be used to create WebApps. Since I don’t have any experience with the three big Web Frameworks: VueJS, React, and Angular, I thought Flutter would be a good fit for me. It also uses Dart instead Javascript. My initial impression was, that this is also an improvement. Since I have not made any proper experiences with other Web Frameworks or Javascript, I won’t be able to compare those to Flutter/Dart in this article. However, I will still talk about my impressions as someone with very little experience in Frontend. My interest is in the Backend and in that regard, we will look at Firebase and how Flutter integrates with it.\nThe project is far from in a finished state and I have no intentions of actually finishing it. Visually it’s not particularly pretty, but it is decently functional. You can check it out yourself here.\nCode Structure The current code structure looks as follows.\n/lib\r│ generated_plugin_registrant.dart\r│ main.dart\r│\r├───Authentification\r│ auth.dart\r│\r├───Constants\r│ constants.dart\r│\r├───Database\r│ db_user.dart\r│\r├───Helper Functions\r│ navigation.dart\r│ numberformat.dart\r│ textfields.dart\r│\r├───Model\r│ food.dart\r│ meal.dart\r│ user.dart\r│\r├───Pages\r│ │ login.dart\r│ │ register.dart\r│ │ welcome.dart\r│ │\r│ └───Mealprep\r│ │ foods.dart\r│ │ home.dart\r│ │ settings.dart\r│ └───Settings\r│ change_activitylevel_page.dart\r│ change_age_page.dart\r│ change_goal_page.dart\r│ change_height_page.dart\r│ change_language_page.dart\r│ change_region_page.dart\r│ change_sex_page.dart\r│ change_weight_page.dart\r│ settings_card.dart\r│\r├───Providers\r│ currently_created_food.dart\r│ currently_created_meal.dart\r│\r└───Widgets\r└───Cards\rfood_card.dart The entrypoint to the app is main.dart. Further sites of the WebApp are found in the /Pages folder. To mirror our logic with dart classes we have the /Model folder. There we find the concepts of foods, meals, and users. Shared constants among the project are found in /Constants/constants.dart. Most of our interaction with the database and the authentication is bundled within the pages, but small shared parts are in their respective Database and Authentication folder. Reused Widgets are in the Widgets folder, but we put very little effort into the visual part of this project, so there is only one item inside that folder. The last and particularly interesting part is the /Providers folder. There we have two classes, which maintain shared state in our WebApp. A user can create new foods and meals and while doing so he visits multiple sites, which need to share a state.\nApp Walkthrough Now that we have seen the general code structure, we will have a walkthrough of the app and its functions. We will refer to the interesting code excerpts while doing so.\nLog In \u0026 Register The first page a user is greeted by is our not-so-pretty welcome screen, in which a user either logs in or registers.\nA nice detail the welcome screen implements is that a user stays logged in even after closing the site, unless of course, he manually logs out. So if a user is logged in already, the welcome screen will automatically refer him to the homepage of the app. This is done as follows.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 @override void initState() { FirebaseAuth.instance.authStateChanges().listen((User user) async { if (user != null \u0026\u0026 !attemptingToLogin) { attemptingToLogin = true; print(\"Attempting to login\"); if (!user.emailVerified) { setState(() { logedInButNotVerified = true; }); } else if (user.emailVerified) { print(\"checking for user data\"); await userReference.doc(\"${user.uid}\").get().then((userSnapshot) async { if (userSnapshot.exists) { print(\"user found\"); } else { await createUserInFirestore(user.uid); } }).catchError((error) =\u003e print(error)); print(\"logged in verified user\"); hardNavigate(context, MealprepTabContainer()); } } }); super.initState(); } If this is the first time looking at Flutter/Firebase code, this is a lot to swallow, so we will go over it one by one. First: the function initState(). I am far from a Flutter expert and will describe things in a simple way. If you are curious about details and intending to become a Flutter expert, I strongly suggest you check out the documentation. Simply put, this function is called when a stateful widget in Flutter is loaded. We won’t go into furth details on stateful and stateless widgets, but the general concept is easy to guess by the name. Some structures in Flutter maintain a state and some don’t. Inside our welcome page, we want to maintain a state, since we want to check, if a user is logged in or not. We do this, by listening to FirebaseAuth. This async function will notify us if the login status changes. Once that happens, we will also check, if our user’s email is verified. Our app only allows verified users to log in. If the user is verified, our helper function hardNavigate() is called and sends the user to the mentioned homepage of the app. We won’t go into any details on how navigation in Flutter works.\nThe login page looks as follows and supports resetting the user’s password.\nThe Flutter version I used, does not support browser autofilling credentials. Since I created this app more than a year ago, I hope they fixed this issue in the meantime.\nAll authentication here is also handled by FirebaseAuth. Additionally, we want to maintain further information on our users. Since this is a calorietracker, we need all sorts of information on our users, such as their age or their weight. So additionally to what FirebaseAuth stores, we create a user object, which we store inside our database Firestore. This exchange between database and dart code is an interesting detail. When we request a user object from the database, we get JSON data, which binds keys to values. Our keys are guaranteed to be strings, while our values might be anything. To create a user object in dart from given data we use the following code.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 MealprepUser.fromMap(Map\u003cString, dynamic\u003e data) { uid = data[\"uid\"]; name = data[\"name\"]; age = data[\"age\"]; height = data[\"height\"]; weight = data[\"weight\"]; sex = data[\"sex\"]; goal = data[\"goal\"]; bmr = data[\"bmr\"]; caloriegoal = data[\"caloriegoal\"]; activitylevel = data[\"activitylevel\"]; language = data[\"language\"]; region = data[\"region\"]; } In dart, we can create Maps with elements of a dynamic type. In this case, it is rather boring, since all the dynamic types are either strings or numbers. The meal class is more exciting.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 Meal.fromMap(Map\u003cString, dynamic\u003e data) { name = data[\"name\"]; description = data[\"description\"]; submitterUID = data[\"submitterUID\"]; calories = data[\"calories\"]; carbs = data[\"carbs\"]; proteins = data[\"proteins\"]; fats = data[\"fats\"]; price = data[\"price\"]; priceonsale = data[\"priceonsale\"]; public = data[\"public\"]; List\u003cdynamic\u003e foodList = data[\"foods\"]; foodList.forEach((element) { foods.add(Food.fromMap(element)); }); } Starting with line 13 we add load food as JSON data from the database, create dart objects of it and add those to our meal.\nBefore this project, I have been taking part in the Stanford online course cs193p, which teaches Swift and SwiftUI. A feature I missed here from Swift is computed properties. In Swift, one can create variables which instead of storing a value, provide a getter and setter function. This would come in handy to automatically update the meal’s properties such as its total calorie count, whenever the object changes. This happens, when a user for example adds a new food to a meal. Instead, we have to manually call the following function, every time we change our meals.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 updateFields() { calories = 0; carbs = 0; proteins = 0; fats = 0; price = 0; priceonsale = 0; foods.forEach((food) { calories += food.calories; carbs += food.carbs; proteins += food.proteins; fats += food.fats; price += food.packageprice; priceonsale += food.packagepricesale; }); } Foods \u0026 Meals Once logged in, the user is greeted by a typical mobile app design. Of all the 4 tabs, only the settings one is useful. The user can change his goals and body measurements there.\nIf the user presses the + button in the middle, he can either create a new food or a new meal.\nWe will look at the food creation to understand the provider class.\nThe food creation consists of 4 pages. These pages simply contain forms, which the user has to fill out. Calories, price, and the name of the food are to be inserted among other things.\nThis form looks as follows in Flutter.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar(), body: Form( key: formKey, child: Padding( padding: const EdgeInsets.all(generalPadding), child: Column( children: [ NumberTextField(\"Barcode\", eanController), StringTextFieldRequired(\"Name*\", nameController), StringTextField(\"Brand\", brandController), RaisedButton( child: Text(\"Continue\"), onPressed: () { validateAndContinue(); }, ), ], ), ), ), ); } Inside a scaffold, we have a Form consisting of a Column with 4 children: 3 TextFields and 1 Button. When the button is pressed the validateAndContinue() function is called. Here our provider class is finally used. First, let’s look at our provider class itself.\n1 2 3 4 5 6 7 class CurrentlyCreatedFood extends ChangeNotifier{ Food food = Food.empty(); bool filledPage1 = false; bool filledPage2 = false; bool filledPage3 = false; } It is very simple, we have a food object and 3 boolean values, which indicate, whether we have already filled a page. Next, we look at how we use this provider class.\n1 2 3 4 5 6 7 8 9 10 11 12 13 validateAndContinue() { if (formKey.currentState.validate()) { var currentFoodProvider = Provider.of\u003cCurrentlyCreatedFood\u003e(context,listen: false); var currentFood = currentFoodProvider.food; currentFood.ean = eanController.text; currentFood.name = nameController.text; currentFood.brand = brandController.text; currentFoodProvider.filledPage1 = true; softNavigate(context, MealprepCreateFoodPage2()); } } Validation is done by Flutter itself, it only verifies that we have numbers in our NumberTextField and text in our StringTextField. Then, we access the currently created food object through this provider class. Next, the user will be navigated to page 2 out of 4.\nLet’s assume the user made a typo and returns to page 1 now. We don’t want to force the user to retype all values. To achieve that, we use the provider shared state again, this time in our initState() function.\n1 2 3 4 5 6 7 8 9 10 11 12 13 @override void initState() { var currentFoodProvider = Provider.of\u003cCurrentlyCreatedFood\u003e(context,listen: false); var currentFood = Provider.of\u003cCurrentlyCreatedFood\u003e(context,listen: false).food; if(currentFoodProvider.filledPage1){ eanController.text = currentFood.ean; nameController.text = currentFood.name; brandController.text = currentFood.brand; } super.initState(); } Our provider class keeps track of which pages we have already filled out. If we return to page 1, the TextFields will be filled out in this way.\nNow if the user reaches page 4 he will be able to submit the food to the database. The code for that looks as follows.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 submitFood() async { var currentFoodProvider = Provider.of\u003cCurrentlyCreatedFood\u003e(context,listen: false); var currentFood = Provider.of\u003cCurrentlyCreatedFood\u003e(context,listen: false).food; // set final meta data, things that user doesnt input var documentSnapshot = await usersReference.doc(\"$authUID\").get(); var user = MealprepUser.fromMap(documentSnapshot.data()); currentFood.submitterUID = authUID; currentFood.region = user.region; var currentFoodAsMap = currentFood.toMap(); FirebaseFirestore.instance .collection(\"foods\") .add(currentFoodAsMap) .then((value) { hardNavigate(context, MealprepTabContainer()); // reset food currentFoodProvider.filledPage1 = false; currentFoodProvider.filledPage2 = false; currentFoodProvider.filledPage3 = false; currentFood = Food.empty(); Fluttertoast.showToast( msg: \"Successfully added the Food.\", toastLength: Toast.LENGTH_LONG); }).catchError((error) { Fluttertoast.showToast( msg: \"Could not add the Food. Something went wrong.\", toastLength: Toast.LENGTH_LONG); }); } First, we access the food object through the provider again. Then we will add some metadata to the food object. Finally, the object can be submitted to the database. For that, we convert our object to JSON data with currentFood.toMap(). Then in the case of a successful submission, we send the user a little feedback in the form of a toast. In the case of an error, we also inform the user appropriately.\nCreating a meal is logically very similar.\nOn the left side, there is a list of all available foods. On the right side, there is a list of already added foods. The user can track the total meal price and calories while adding foods. If now the user wants to add Rigatoni, but not 500g, which is the default package size, he can click the item, and a modal opens.\nNot particularly pretty, but it gets the job done. If the user presses done, the updated package size, here 250g, will be added to the meal.\nIf the user is done, he can submit the meal to the database. The user may also choose if the meal is visible to others with the public toggle. The same applies to foods.\nConclusion From a technical point of view, there are two interesting parts: Flutter and Firebase. Regarding Flutter, I have been very happy with the resources available online. The code structure and concepts are very intuitive. However, I am not able to compare Flutter to other Cross-Platform Frameworks or Web Frameworks. Working with Firebase was also very intuitive. The Firebase Authentication service is well documented and easily integrates into Flutter Apps. Firestore, the Firebase Database, provides 50.000 free reads, 20.000 free writes, and 20.000 free deletes per day. For a hobby project, this is more than plenty. Functionality wise it also provides everything you would expect from a document-oriented database. I have not worked with a database as a service before and can only compare my experience to working with for example self-hosted RocksDB or a typical SQL database such as MySQL or SQLite. The fact, that you don’t have to worry about the hardware, on which the database runs, is of course comfortable. However, for a big project, I would be cautious concerning the costs. Changing from one NoSQL database to another can be a difficult process. I would spend a fair amount of time researching which database to use.\nThe second part of this project is the actual content. A calorietracker is of course nothing new. There are plenty of great ones out there already. One feature I am personally missing from them is more statistics! I would love to have something like the Spotify yearly review but for my nutrition. Also, the calorietrackers don’t track the costs of the foods consumed. I would love to have that available too. I will not continue the development of this app. While in theory, it should be easy to add missing features and port this app to iOS and Android, Making it a real product and competing with established solutions, which already have a strong userbase and plenty of items in their database seems unrealistic. Rather, I would love to have one of the established apps add some more statistics.\n","wordCount":"2473","inLanguage":"en","image":"https://huti26.github.io/flutter+firebase2.jpg","datePublished":"2022-05-12T00:00:00Z","dateModified":"2022-05-12T00:00:00Z","author":{"@type":"Person","name":"Hutan Baghery Moghaddam"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://huti26.github.io/posts/flutter-calorietracker/flutter-calorietracker/"},"publisher":{"@type":"Organization","name":"Hutan Baghery Moghaddam","logo":{"@type":"ImageObject","url":"https://huti26.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://huti26.github.io/ accesskey=h title="Hutan BM (Alt + H)">Hutan BM</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://huti26.github.io/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://huti26.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://huti26.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://huti26.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://huti26.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>What I learned from building a Calorietracker/Budgeting WebApp with Flutter and Firebase</h1><div class=post-meta><span title='2022-05-12 00:00:00 +0000 UTC'>May 12, 2022</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;2473 words&nbsp;·&nbsp;Hutan Baghery Moghaddam</div></header><figure class=entry-cover><img loading=lazy src=https://huti26.github.io/flutter+firebase2.jpg alt></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#preface>Preface</a></li><li><a href=#code-structure>Code Structure</a></li><li><a href=#app-walkthrough>App Walkthrough</a></li><li><a href=#log-in--register>Log In & Register</a></li><li><a href=#foods--meals>Foods & Meals</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details></div><div class=post-content><h2 id=preface>Preface<a hidden class=anchor aria-hidden=true href=#preface>#</a></h2><p>Flutter is first and foremost a Framework to create cross-platform applications, but it can also be used to create WebApps. Since I don&rsquo;t have any experience with the three big Web Frameworks: VueJS, React, and Angular, I thought Flutter would be a good fit for me. It also uses Dart instead Javascript. My initial impression was, that this is also an improvement. Since I have not made any proper experiences with other Web Frameworks or Javascript, I won&rsquo;t be able to compare those to Flutter/Dart in this article. However, I will still talk about my impressions as someone with very little experience in Frontend. My interest is in the Backend and in that regard, we will look at Firebase and how Flutter integrates with it.</p><p>The project is far from in a finished state and I have no intentions of actually finishing it. Visually it&rsquo;s not particularly pretty, but it is decently functional. You can check it out yourself <a href=https://huti26.github.io/calorietracker/ target=_blank rel=noopener>here</a>.</p><h2 id=code-structure>Code Structure<a hidden class=anchor aria-hidden=true href=#code-structure>#</a></h2><p>The current code structure looks as follows.</p><pre tabindex=0><code class=language-terminal data-lang=terminal>/lib
│   generated_plugin_registrant.dart
│   main.dart
│
├───Authentification
│       auth.dart
│
├───Constants
│       constants.dart
│
├───Database
│       db_user.dart
│
├───Helper Functions
│       navigation.dart
│       numberformat.dart
│       textfields.dart
│
├───Model
│       food.dart
│       meal.dart
│       user.dart
│
├───Pages
│   │   login.dart
│   │   register.dart
│   │   welcome.dart
│   │
│   └───Mealprep
│       │   foods.dart
│       │   home.dart
│       │   settings.dart
│       └───Settings
│               change_activitylevel_page.dart
│               change_age_page.dart
│               change_goal_page.dart
│               change_height_page.dart
│               change_language_page.dart
│               change_region_page.dart
│               change_sex_page.dart
│               change_weight_page.dart
│               settings_card.dart
│
├───Providers
│       currently_created_food.dart
│       currently_created_meal.dart
│
└───Widgets
    └───Cards
            food_card.dart
</code></pre><p>The entrypoint to the app is <code>main.dart</code>. Further sites of the WebApp are found in the <code>/Pages</code> folder. To mirror our logic with dart classes we have the <code>/Model</code> folder. There we find the concepts of foods, meals, and users. Shared constants among the project are found in <code>/Constants/constants.dart</code>. Most of our interaction with the database and the authentication is bundled within the pages, but small shared parts are in their respective <code>Database</code> and <code>Authentication</code> folder. Reused Widgets are in the <code>Widgets</code> folder, but we put very little effort into the visual part of this project, so there is only one item inside that folder. The last and particularly interesting part is the <code>/Providers</code> folder. There we have two classes, which maintain shared state in our WebApp. A user can create new foods and meals and while doing so he visits multiple sites, which need to share a state.</p><h2 id=app-walkthrough>App Walkthrough<a hidden class=anchor aria-hidden=true href=#app-walkthrough>#</a></h2><p>Now that we have seen the general code structure, we will have a walkthrough of the app and its functions. We will refer to the interesting code excerpts while doing so.</p><h2 id=log-in--register>Log In & Register<a hidden class=anchor aria-hidden=true href=#log-in--register>#</a></h2><p>The first page a user is greeted by is our not-so-pretty welcome screen, in which a user either logs in or registers.</p><p><img loading=lazy src=../../../posts/flutter-calorietracker/images/welcome.png alt></p><p>A nice detail the welcome screen implements is that a user stays logged in even after closing the site, unless of course, he manually logs out. So if a user is logged in already, the welcome screen will automatically refer him to the homepage of the app. This is done as follows.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=err>@</span><span class=nx>override</span>
</span></span><span class=line><span class=cl><span class=k>void</span> <span class=nx>initState</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>FirebaseAuth</span><span class=p>.</span><span class=nx>instance</span><span class=p>.</span><span class=nx>authStateChanges</span><span class=p>().</span><span class=nx>listen</span><span class=p>((</span><span class=nx>User</span> <span class=nx>user</span><span class=p>)</span> <span class=kr>async</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>user</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>attemptingToLogin</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>attemptingToLogin</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>print</span><span class=p>(</span><span class=s2>&#34;Attempting to login&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>user</span><span class=p>.</span><span class=nx>emailVerified</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setState</span><span class=p>(()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>logedInButNotVerified</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nx>emailVerified</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>print</span><span class=p>(</span><span class=s2>&#34;checking for user data&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>await</span> <span class=nx>userReference</span><span class=p>.</span><span class=nx>doc</span><span class=p>(</span><span class=s2>&#34;${user.uid}&#34;</span><span class=p>).</span><span class=nx>get</span><span class=p>().</span><span class=nx>then</span><span class=p>((</span><span class=nx>userSnapshot</span><span class=p>)</span> <span class=kr>async</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>userSnapshot</span><span class=p>.</span><span class=nx>exists</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>print</span><span class=p>(</span><span class=s2>&#34;user found&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>createUserInFirestore</span><span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nx>uid</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}).</span><span class=nx>catchError</span><span class=p>((</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>print</span><span class=p>(</span><span class=nx>error</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=nx>print</span><span class=p>(</span><span class=s2>&#34;logged in verified user&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>hardNavigate</span><span class=p>(</span><span class=nx>context</span><span class=p>,</span> <span class=nx>MealprepTabContainer</span><span class=p>());</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=kr>super</span><span class=p>.</span><span class=nx>initState</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>If this is the first time looking at Flutter/Firebase code, this is a lot to swallow, so we will go over it one by one. First: the function <code>initState()</code>. I am far from a Flutter expert and will describe things in a simple way. If you are curious about details and intending to become a Flutter expert, I strongly suggest you check out the <a href=https://api.flutter.dev/flutter/widgets/State/initState.html target=_blank rel=noopener>documentation</a>. Simply put, this function is called when a stateful widget in Flutter is loaded. We won&rsquo;t go into furth details on stateful and stateless widgets, but the general concept is easy to guess by the name. Some structures in Flutter maintain a state and some don&rsquo;t. Inside our welcome page, we want to maintain a state, since we want to check, if a user is logged in or not. We do this, by listening to <code>FirebaseAuth</code>. This async function will notify us if the login status changes. Once that happens, we will also check, if our user&rsquo;s email is verified. Our app only allows verified users to log in. If the user is verified, our helper function <code>hardNavigate()</code> is called and sends the user to the mentioned homepage of the app. We won&rsquo;t go into any details on how navigation in Flutter works.</p><p>The login page looks as follows and supports resetting the user&rsquo;s password.</p><p><img loading=lazy src=../../../posts/flutter-calorietracker/images/login.png alt></p><p>The Flutter version I used, does not support browser autofilling credentials. Since I created this app more than a year ago, I hope they fixed this issue in the meantime.</p><p>All authentication here is also handled by <code>FirebaseAuth</code>. Additionally, we want to maintain further information on our users. Since this is a calorietracker, we need all sorts of information on our users, such as their age or their weight. So additionally to what <code>FirebaseAuth</code> stores, we create a user object, which we store inside our database <code>Firestore</code>. This exchange between database and dart code is an interesting detail. When we request a user object from the database, we get JSON data, which binds keys to values. Our keys are guaranteed to be strings, while our values might be anything. To create a user object in dart from given data we use the following code.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>MealprepUser</span><span class=p>.</span><span class=nx>fromMap</span><span class=p>(</span><span class=nx>Map</span><span class=o>&lt;</span><span class=nb>String</span><span class=p>,</span> <span class=nx>dynamic</span><span class=o>&gt;</span> <span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>uid</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;uid&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>age</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;age&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>height</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;height&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>weight</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;weight&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>sex</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;sex&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>goal</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;goal&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>bmr</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;bmr&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>caloriegoal</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;caloriegoal&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>activitylevel</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;activitylevel&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>language</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;language&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>region</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;region&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>In dart, we can create Maps with elements of a dynamic type. In this case, it is rather boring, since all the dynamic types are either strings or numbers. The meal class is more exciting.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>Meal</span><span class=p>.</span><span class=nx>fromMap</span><span class=p>(</span><span class=nx>Map</span><span class=o>&lt;</span><span class=nb>String</span><span class=p>,</span> <span class=nx>dynamic</span><span class=o>&gt;</span> <span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>description</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;description&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>submitterUID</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;submitterUID&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>calories</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;calories&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>carbs</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;carbs&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>proteins</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;proteins&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>fats</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;fats&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>price</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;price&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>priceonsale</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;priceonsale&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;public&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>List</span><span class=o>&lt;</span><span class=nx>dynamic</span><span class=o>&gt;</span> <span class=nx>foodList</span> <span class=o>=</span> <span class=nx>data</span><span class=p>[</span><span class=s2>&#34;foods&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>foodList</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>element</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>foods</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>Food</span><span class=p>.</span><span class=nx>fromMap</span><span class=p>(</span><span class=nx>element</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Starting with line 13 we add load food as JSON data from the database, create dart objects of it and add those to our meal.</p><p>Before this project, I have been taking part in the Stanford online course cs193p, which teaches Swift and SwiftUI. A feature I missed here from Swift is <a href=https://docs.swift.org/swift-book/LanguageGuide/Properties.html target=_blank rel=noopener>computed properties</a>. In Swift, one can create variables which instead of storing a value, provide a getter and setter function. This would come in handy to automatically update the meal&rsquo;s properties such as its total calorie count, whenever the object changes. This happens, when a user for example adds a new food to a meal. Instead, we have to manually call the following function, every time we change our meals.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>updateFields</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>calories</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>carbs</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>proteins</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>fats</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>price</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>priceonsale</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>foods</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>food</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>calories</span> <span class=o>+=</span> <span class=nx>food</span><span class=p>.</span><span class=nx>calories</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>carbs</span> <span class=o>+=</span> <span class=nx>food</span><span class=p>.</span><span class=nx>carbs</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>proteins</span> <span class=o>+=</span> <span class=nx>food</span><span class=p>.</span><span class=nx>proteins</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>fats</span> <span class=o>+=</span> <span class=nx>food</span><span class=p>.</span><span class=nx>fats</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>price</span> <span class=o>+=</span> <span class=nx>food</span><span class=p>.</span><span class=nx>packageprice</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>priceonsale</span> <span class=o>+=</span> <span class=nx>food</span><span class=p>.</span><span class=nx>packagepricesale</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=foods--meals>Foods & Meals<a hidden class=anchor aria-hidden=true href=#foods--meals>#</a></h2><p>Once logged in, the user is greeted by a typical mobile app design. Of all the 4 tabs, only the settings one is useful. The user can change his goals and body measurements there.</p><p><img loading=lazy src=../../../posts/flutter-calorietracker/images/settings.png alt></p><p>If the user presses the + button in the middle, he can either create a new food or a new meal.</p><p><img loading=lazy src=../../../posts/flutter-calorietracker/images/plus-button.png alt></p><p>We will look at the food creation to understand the provider class.</p><p>The food creation consists of 4 pages. These pages simply contain forms, which the user has to fill out. Calories, price, and the name of the food are to be inserted among other things.</p><p><img loading=lazy src=../../../posts/flutter-calorietracker/images/food1.png alt></p><p>This form looks as follows in Flutter.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=err>@</span><span class=nx>override</span>
</span></span><span class=line><span class=cl><span class=nx>Widget</span> <span class=nx>build</span><span class=p>(</span><span class=nx>BuildContext</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>Scaffold</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>appBar</span><span class=o>:</span> <span class=nx>AppBar</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span><span class=o>:</span> <span class=nx>Form</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>key</span><span class=o>:</span> <span class=nx>formKey</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>child</span><span class=o>:</span> <span class=nx>Padding</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>padding</span><span class=o>:</span> <span class=kr>const</span> <span class=nx>EdgeInsets</span><span class=p>.</span><span class=nx>all</span><span class=p>(</span><span class=nx>generalPadding</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>child</span><span class=o>:</span> <span class=nx>Column</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=nx>children</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=nx>NumberTextField</span><span class=p>(</span><span class=s2>&#34;Barcode&#34;</span><span class=p>,</span> <span class=nx>eanController</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>StringTextFieldRequired</span><span class=p>(</span><span class=s2>&#34;Name*&#34;</span><span class=p>,</span> <span class=nx>nameController</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>StringTextField</span><span class=p>(</span><span class=s2>&#34;Brand&#34;</span><span class=p>,</span> <span class=nx>brandController</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=nx>RaisedButton</span><span class=p>(</span>
</span></span><span class=line><span class=cl>              <span class=nx>child</span><span class=o>:</span> <span class=nx>Text</span><span class=p>(</span><span class=s2>&#34;Continue&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>              <span class=nx>onPressed</span><span class=o>:</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>validateAndContinue</span><span class=p>();</span>
</span></span><span class=line><span class=cl>              <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>),</span>
</span></span><span class=line><span class=cl>          <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Inside a scaffold, we have a Form consisting of a Column with 4 children: 3 TextFields and 1 Button. When the button is pressed the <code>validateAndContinue()</code> function is called. Here our provider class is finally used. First, let&rsquo;s look at our provider class itself.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>CurrentlyCreatedFood</span> <span class=kr>extends</span> <span class=nx>ChangeNotifier</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>Food</span> <span class=nx>food</span> <span class=o>=</span> <span class=nx>Food</span><span class=p>.</span><span class=nx>empty</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>bool</span> <span class=nx>filledPage1</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>bool</span> <span class=nx>filledPage2</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>bool</span> <span class=nx>filledPage3</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>It is very simple, we have a food object and 3 boolean values, which indicate, whether we have already filled a page. Next, we look at how we use this provider class.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>validateAndContinue</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>formKey</span><span class=p>.</span><span class=nx>currentState</span><span class=p>.</span><span class=nx>validate</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>currentFoodProvider</span> <span class=o>=</span> <span class=nx>Provider</span><span class=p>.</span><span class=k>of</span><span class=o>&lt;</span><span class=nx>CurrentlyCreatedFood</span><span class=o>&gt;</span><span class=p>(</span><span class=nx>context</span><span class=p>,</span><span class=nx>listen</span><span class=o>:</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>currentFood</span> <span class=o>=</span> <span class=nx>currentFoodProvider</span><span class=p>.</span><span class=nx>food</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>currentFood</span><span class=p>.</span><span class=nx>ean</span> <span class=o>=</span> <span class=nx>eanController</span><span class=p>.</span><span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>currentFood</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>nameController</span><span class=p>.</span><span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>currentFood</span><span class=p>.</span><span class=nx>brand</span> <span class=o>=</span> <span class=nx>brandController</span><span class=p>.</span><span class=nx>text</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>currentFoodProvider</span><span class=p>.</span><span class=nx>filledPage1</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>softNavigate</span><span class=p>(</span><span class=nx>context</span><span class=p>,</span> <span class=nx>MealprepCreateFoodPage2</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Validation is done by Flutter itself, it only verifies that we have numbers in our NumberTextField and text in our StringTextField. Then, we access the currently created food object through this provider class. Next, the user will be navigated to page 2 out of 4.</p><p><img loading=lazy src=../../../posts/flutter-calorietracker/images/food2.png alt></p><p>Let&rsquo;s assume the user made a typo and returns to page 1 now. We don&rsquo;t want to force the user to retype all values. To achieve that, we use the provider shared state again, this time in our <code>initState()</code> function.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=err>@</span><span class=nx>override</span>
</span></span><span class=line><span class=cl><span class=k>void</span> <span class=nx>initState</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>currentFoodProvider</span> <span class=o>=</span> <span class=nx>Provider</span><span class=p>.</span><span class=k>of</span><span class=o>&lt;</span><span class=nx>CurrentlyCreatedFood</span><span class=o>&gt;</span><span class=p>(</span><span class=nx>context</span><span class=p>,</span><span class=nx>listen</span><span class=o>:</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>currentFood</span> <span class=o>=</span> <span class=nx>Provider</span><span class=p>.</span><span class=k>of</span><span class=o>&lt;</span><span class=nx>CurrentlyCreatedFood</span><span class=o>&gt;</span><span class=p>(</span><span class=nx>context</span><span class=p>,</span><span class=nx>listen</span><span class=o>:</span> <span class=kc>false</span><span class=p>).</span><span class=nx>food</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=nx>currentFoodProvider</span><span class=p>.</span><span class=nx>filledPage1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nx>eanController</span><span class=p>.</span><span class=nx>text</span> <span class=o>=</span> <span class=nx>currentFood</span><span class=p>.</span><span class=nx>ean</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>nameController</span><span class=p>.</span><span class=nx>text</span> <span class=o>=</span> <span class=nx>currentFood</span><span class=p>.</span><span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>brandController</span><span class=p>.</span><span class=nx>text</span> <span class=o>=</span> <span class=nx>currentFood</span><span class=p>.</span><span class=nx>brand</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>super</span><span class=p>.</span><span class=nx>initState</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Our provider class keeps track of which pages we have already filled out. If we return to page 1, the TextFields will be filled out in this way.</p><p>Now if the user reaches page 4 he will be able to submit the food to the database. The code for that looks as follows.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>submitFood</span><span class=p>()</span> <span class=kr>async</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>currentFoodProvider</span> <span class=o>=</span> <span class=nx>Provider</span><span class=p>.</span><span class=k>of</span><span class=o>&lt;</span><span class=nx>CurrentlyCreatedFood</span><span class=o>&gt;</span><span class=p>(</span><span class=nx>context</span><span class=p>,</span><span class=nx>listen</span><span class=o>:</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>currentFood</span> <span class=o>=</span> <span class=nx>Provider</span><span class=p>.</span><span class=k>of</span><span class=o>&lt;</span><span class=nx>CurrentlyCreatedFood</span><span class=o>&gt;</span><span class=p>(</span><span class=nx>context</span><span class=p>,</span><span class=nx>listen</span><span class=o>:</span> <span class=kc>false</span><span class=p>).</span><span class=nx>food</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// set final meta data, things that user doesnt input
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>documentSnapshot</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>usersReference</span><span class=p>.</span><span class=nx>doc</span><span class=p>(</span><span class=s2>&#34;$authUID&#34;</span><span class=p>).</span><span class=nx>get</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>MealprepUser</span><span class=p>.</span><span class=nx>fromMap</span><span class=p>(</span><span class=nx>documentSnapshot</span><span class=p>.</span><span class=nx>data</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=nx>currentFood</span><span class=p>.</span><span class=nx>submitterUID</span> <span class=o>=</span> <span class=nx>authUID</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>currentFood</span><span class=p>.</span><span class=nx>region</span> <span class=o>=</span> <span class=nx>user</span><span class=p>.</span><span class=nx>region</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>currentFoodAsMap</span> <span class=o>=</span> <span class=nx>currentFood</span><span class=p>.</span><span class=nx>toMap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>FirebaseFirestore</span><span class=p>.</span><span class=nx>instance</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>collection</span><span class=p>(</span><span class=s2>&#34;foods&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>currentFoodAsMap</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>hardNavigate</span><span class=p>(</span><span class=nx>context</span><span class=p>,</span> <span class=nx>MealprepTabContainer</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// reset food
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>currentFoodProvider</span><span class=p>.</span><span class=nx>filledPage1</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>currentFoodProvider</span><span class=p>.</span><span class=nx>filledPage2</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>currentFoodProvider</span><span class=p>.</span><span class=nx>filledPage3</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>currentFood</span> <span class=o>=</span> <span class=nx>Food</span><span class=p>.</span><span class=nx>empty</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>Fluttertoast</span><span class=p>.</span><span class=nx>showToast</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>msg</span><span class=o>:</span> <span class=s2>&#34;Successfully added the Food.&#34;</span><span class=p>,</span> <span class=nx>toastLength</span><span class=o>:</span> <span class=nx>Toast</span><span class=p>.</span><span class=nx>LENGTH_LONG</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}).</span><span class=nx>catchError</span><span class=p>((</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Fluttertoast</span><span class=p>.</span><span class=nx>showToast</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>msg</span><span class=o>:</span> <span class=s2>&#34;Could not add the Food. Something went wrong.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>toastLength</span><span class=o>:</span> <span class=nx>Toast</span><span class=p>.</span><span class=nx>LENGTH_LONG</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>First, we access the food object through the provider again. Then we will add some metadata to the food object. Finally, the object can be submitted to the database. For that, we convert our object to JSON data with <code>currentFood.toMap()</code>. Then in the case of a successful submission, we send the user a little feedback in the form of a toast. In the case of an error, we also inform the user appropriately.</p><p>Creating a meal is logically very similar.</p><p><img loading=lazy src=../../../posts/flutter-calorietracker/images/meal1.png alt></p><p>On the left side, there is a list of all available foods. On the right side, there is a list of already added foods. The user can track the total meal price and calories while adding foods. If now the user wants to add Rigatoni, but not 500g, which is the default package size, he can click the item, and a modal opens.</p><p><img loading=lazy src=../../../posts/flutter-calorietracker/images/meal2.png alt></p><p>Not particularly pretty, but it gets the job done. If the user presses done, the updated package size, here 250g, will be added to the meal.</p><p><img loading=lazy src=../../../posts/flutter-calorietracker/images/meal3.png alt></p><p>If the user is done, he can submit the meal to the database. The user may also choose if the meal is visible to others with the public toggle. The same applies to foods.</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>From a technical point of view, there are two interesting parts: Flutter and Firebase. Regarding Flutter, I have been very happy with the resources available online. The code structure and concepts are very intuitive. However, I am not able to compare Flutter to other Cross-Platform Frameworks or Web Frameworks. Working with Firebase was also very intuitive. The Firebase Authentication service is well documented and easily integrates into Flutter Apps. Firestore, the Firebase Database, provides 50.000 free reads, 20.000 free writes, and 20.000 free deletes per day. For a hobby project, this is more than plenty. Functionality wise it also provides everything you would expect from a document-oriented database. I have not worked with a database as a service before and can only compare my experience to working with for example self-hosted RocksDB or a typical SQL database such as MySQL or SQLite. The fact, that you don&rsquo;t have to worry about the hardware, on which the database runs, is of course comfortable. However, for a big project, I would be cautious concerning the costs. Changing from one NoSQL database to another can be a difficult process. I would spend a fair amount of time researching which database to use.</p><p>The second part of this project is the actual content. A calorietracker is of course nothing new. There are plenty of great ones out there already. One feature I am personally missing from them is more statistics! I would love to have something like the Spotify yearly review but for my nutrition. Also, the calorietrackers don&rsquo;t track the costs of the foods consumed. I would love to have that available too. I will not continue the development of this app. While in theory, it should be easy to add missing features and port this app to iOS and Android, Making it a real product and competing with established solutions, which already have a strong userbase and plenty of items in their database seems unrealistic. Rather, I would love to have one of the established apps add some more statistics.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://huti26.github.io/tags/flutter/>Flutter</a></li><li><a href=https://huti26.github.io/tags/firebase/>Firebase</a></li><li><a href=https://huti26.github.io/tags/personal-projects/>Personal Projects</a></li></ul><nav class=paginav><a class=prev href=https://huti26.github.io/posts/formula-1/hamilton-vs-bottas/><span class=title>« Prev</span><br><span>Lewis Hamilton 2017-2021</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://huti26.github.io/>Hutan Baghery Moghaddam</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>